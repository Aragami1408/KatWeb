<!DOCTYPE html>
<html lang=en>
	<head>
		<meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1" name=viewport>
		<style>body{margin:0;font:16px/1.5 sans-serif;overflow:hidden;-webkit-user-select:none;cursor:default}#div{padding:16px}h3{font-weight:400;margin:0;font-size:24px}#output,a{color:#fff;background-color:#222d32}#output::selection{background:#fff;color:#222d32}a,span{text-align:center}a{display:inline-block;text-decoration:none;max-width:800px;margin:auto;padding:8px 16px;width:40%}span{position:absolute;width:100%;padding:3px 0;color:#fff;right:20px}#output{overflow-y:scroll;word-wrap:break-word;display:flex;flex-direction:column-reverse;font-size:14px;font-family:monospace;bottom:0;height:150px;-webkit-user-select:auto}::-webkit-scrollbar{width:12px}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.8)}::-webkit-scrollbar-thumb{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.8)}a:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);transition:box-shadow .15s,opacity .25s,filter .25s,border .15s}</style>
	</head>
	<body>
		<div id=div>
			<h3>Controls</h3>
			<p id=statbar>Waiting for backend...
			<p><a onclick="socket.send('folder')" style="margin-right: 8px">View KatWeb Folder</a>
			<a onclick="socket.send('restart')">Restart Server</a>
			<p><a onclick="socket.send('config')" style="margin-right: 8px">Edit Config File</a>
			<a onclick="socket.send('reload')">Reload Config</a>
			<h3>Console</h3>
			<p id=output>
		</div>
		<script>
		var socket = new WebSocket("ws://localhost:8090/socket")
		var out = document.getElementById("output")

		socket.onmessage = function (event) {
			if (event.data.startsWith("[")) {
				out.innerHTML = out.innerHTML.trimdata(2500) + event.data + "</br>"
				return
			}
			if (event.data == "start" || event.data == "restart") {
				document.getElementById("statbar").innerHTML = "Connected to KatWeb."
			}
			if (event.data == "clear" || event.data == "start" || event.data == "restart") {
				out.innerHTML = ""
				return
			}
			if (event.data == "stop") {
				document.getElementById("statbar").innerHTML = "KatWeb is not running!"
				return
			}
			if (event.data == "err") {
				out.innerHTML = "Unable to start KatWeb!"
				return
			}
			if (event.data == "reload") {
				return
			}
			return document.getElementById("statbar").innerHTML = event.data
		}

		/*const {ipcRenderer, remote} = require('electron')
		const pidusage = require('pidusage')
		var pid

		ipcRenderer.send('asynchronous-message', 'init')
		ipcRenderer.on('asynchronous-reply', (event, arg) => {
			if (arg == "clear") {
				return out.innerHTML = ""
			}
			if (arg == "not") {
				return document.getElementById("statbar").innerHTML = "KatWeb is not running."
			}
			if (arg == "err") {
				return document.getElementById("statbar").innerHTML = "Unable to start KatWeb!"
			}
			if (arg == "trim") {
				return out.innerHTML = out.innerHTML.trimdata(-49)
			}
			pid = arg
		})
		ipcRenderer.on('asynchronous-message', (event, arg) => {
			out.innerHTML = out.innerHTML.trimdata(2500) + arg.split(/\n/g).join("</br>")
		})


		setInterval(function () {
			pidusage(pid, function (err, stats) {
				if (stats == null) {
					return
				}
				document.getElementById("statbar").innerHTML = stats.cpu + "% Avg CPU | " + Math.round(stats.memory/100000)/10 + "mb RAM | PID : " + stats.pid
			})
		}, 250)*/

		String.prototype.trimdata = function (length) {
			if (0 > length) {
				return this.substring(0, this.length+length)
			}
			return this.length > length*1.5 ? this.substring(this.length-length, this.length) : this;
		}
		</script>
	</body>
</html>
